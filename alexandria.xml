<?xml version="1.0" encoding="UTF-8"?>

<article xmlns="http://docbook.org/ns/docbook" xml:id="alexandria" version="5.0">

	<info>
		<title>Alexandria</title>
		<subtitle>Company library</subtitle>
		<author> <personname>Marek Dudek</personname> <email>marek.dudek@gmail.com</email> </author>
		<pubdate> <?dbtimestamp format="A, d of B, Y"?> </pubdate>
		<abstract>
			<para>Documentation for project Alexandria - application for management of a company library. Demonstration of Domain Driven Design methodology.</para>
		</abstract>
	</info>

	<section xml:id="properties"> <title>Properties</title>
		<itemizedlist> <title>List of properties</title>
			<listitem> <para> <emphasis>Package: </emphasis> <code>biz.interretis.alexandria</code> </para> </listitem>
			<listitem> <para><emphasis>Methodology: </emphasis>Design-driven development</para> </listitem>
			<listitem>
				<itemizedlist> <para>Technological stack</para>
					<listitem>
						<itemizedlist> <para>Struts 1</para>
							<listitem> <para>Tiles</para> </listitem>
							<listitem> <para>Tags</para> </listitem>
							<listitem> <para>Validation</para> </listitem>
						</itemizedlist>
					</listitem>
					<listitem>
						<itemizedlist> <para>JPA 2</para>
							<listitem> <para>Validation API</para> </listitem>
							<listitem> <para>Criteria API</para> </listitem>
							<listitem> <para>Eclipselink</para> </listitem>
						</itemizedlist>
					</listitem>
					<listitem>
						<itemizedlist> <para>Spring</para>
							<listitem> <para>Spring Security</para> </listitem>
						</itemizedlist>
					</listitem>
					<listitem>
						<itemizedlist> <para>OSGi</para>
							<listitem> <para>Spring Dynamic Modules - Eclipse Blueprint</para> </listitem>
						</itemizedlist>
					</listitem>
					<listitem> <para>Test NG</para> </listitem>
					<listitem> <para>Java Servlet (&lt;3.0) &amp; JSP &amp; JSTL</para> </listitem>
					<listitem> <para>Tomcat? Weblogic?</para> </listitem>
				</itemizedlist>
			</listitem>
		</itemizedlist>
	</section>

	<section xml:id="requirements"> <title>Requirements</title>
		<itemizedlist> <title>Requirements of the application</title>
			<listitem> 
				<para>browsing 
					<glossterm baseform="Book" linkend="book">Books</glossterm> and 
					<glossterm baseform="Library" linkend="library">Libraries</glossterm>
				</para> 
			</listitem>
			<listitem>
				<itemizedlist> <para>CRUD</para>
					<listitem>
						<itemizedlist> <para><glossterm baseform="Book" linkend="book">Books</glossterm></para>
							<listitem>
								<itemizedlist> <para>add and remove subsequent <glossterm linkend="copy">Copy</glossterm> of existing one</para>
									<listitem> <para>propose switching between "Add Copy of existing" and "Create new"</para> </listitem>
									<listitem> <para>on removing multi-Copied only decrease copy count</para> </listitem>
								</itemizedlist>
							</listitem>
							<listitem>
								<itemizedlist> <para>add and remove subsequent <glossterm linkend="version">Version</glossterm> of existing one</para>
									<listitem> <para>allow relating newly created as Versions</para> </listitem>
									<listitem> <para>add middle Version of existing one</para> </listitem>
								</itemizedlist>
							</listitem>
						</itemizedlist>
					</listitem>
					<listitem> <para><glossterm baseform="Library" linkend="library">Libraries</glossterm></para>
						<itemizedlist>
							<listitem> <para>adding <glossterm baseform="Book" linkend="book">Books</glossterm></para> </listitem>
						</itemizedlist>
					</listitem>
					<listitem> <para>Users</para>
						<itemizedlist>
							<listitem> <para>Borrowing and Returning <glossterm baseform="Book" linkend="book">Books</glossterm></para> </listitem>
							<listitem> <para>adding to a Team</para> </listitem>
							<listitem> <para>letting Borrow a <glossterm baseform="Book" linkend="book">Books</glossterm></para> </listitem>
						</itemizedlist>
					</listitem>
					<listitem> <para>Teams</para>
						<itemizedlist>
							<listitem> <para>has members, organizes them, aggregate root</para> </listitem>
							<listitem> <para>has Leader -&gt; User</para>
								<itemizedlist>
									<listitem> <para>Leader manages Team owenership</para> </listitem>
								</itemizedlist>
							</listitem>
							<listitem> <para>aggregate root for Users</para> </listitem>
						</itemizedlist>
					</listitem>
				</itemizedlist>
			</listitem>
			<listitem> <para>Borrowing and Returning <glossterm baseform="Book" linkend="book">Books</glossterm></para> </listitem>
			<listitem> <para>Authentication and authorization</para> </listitem>
		</itemizedlist>
	</section>

	<section xml:id="ubiquitous-language"> <title>Ubiquitous language</title>
		<para>List of terms making up the Ubiquitous Language of Alexandria project</para>
		<glossary> 
			<glossentry xml:id="book">
				<glossterm>Book</glossterm>
				<glossdef>
					<itemizedlist>
						<listitem> <para>belongs to Library</para> 
							<itemizedlist>
								<listitem> <para>shouldn't have to know about it</para> </listitem>
							</itemizedlist>
						</listitem>
						<listitem> <para>multiple indistinguishable Copies</para> 
							<itemizedlist>
								<listitem> <para>Copy identification?</para> </listitem>
								<listitem> <para>two Copies may belong to multiple Libraries</para> </listitem>
							</itemizedlist>
						</listitem>
						<listitem> <para>progressive Versions</para> 
							<itemizedlist>
								<listitem> <para>relations between Versions</para> 
									<itemizedlist>
										<listitem> <para>order number</para> </listitem>
										<listitem> <para>double-sided linking?</para> </listitem>
										<listitem> <para>both or single?</para> </listitem>
									</itemizedlist>
								</listitem>
							</itemizedlist>
						</listitem>
						<listitem> <para>relation to Author</para> 
							<itemizedlist>
								<listitem> <para>m-2-m, how to constrain it?</para> </listitem>
							</itemizedlist>
						</listitem>
						<listitem> <para>aggregate root, controls creation of Versions and Copies</para> 
							<itemizedlist>
								<listitem> <para>reconsider making it completely obsolete</para> </listitem>
							</itemizedlist>
						</listitem>
						<listitem> <para>connection Copy with Versions</para> 
							<itemizedlist>
								<listitem> <para>Copy is always created, Version is optionally created as soon as another copy created</para> </listitem>
								<listitem> <para>removing Books should keep Versions</para> </listitem>
							</itemizedlist>
						</listitem>
					</itemizedlist>
				</glossdef>
			</glossentry>
			<glossentry xml:id="version">
				<glossterm>Version</glossterm>
				<glossdef>
					<itemizedlist>
						<listitem> <para>what does it share with Book?</para> </listitem>
						<listitem> <para>should it know about Books?</para> </listitem>
					</itemizedlist>
				</glossdef>
			</glossentry>
			<glossentry xml:id="copy">
				<glossterm>Copy</glossterm>
				<glossdef>
					<itemizedlist>
						<listitem> <para>borrowed and returned by Users</para> </listitem>
						<listitem> <para>statuses?</para> 
							<itemizedlist>
								<listitem> <para>free</para> </listitem>
								<listitem> <para>borrowed</para> </listitem>
								<listitem> <para>lost</para> </listitem>
								<listitem> <para>arriving - possible booking in advance</para> </listitem>
								<listitem> <para>contested - possibly multiple Users</para> </listitem>
							</itemizedlist>
						</listitem>
					</itemizedlist>
				</glossdef>
			</glossentry>
			<glossentry xml:id="library">
				<glossterm>Library</glossterm>
				<glossdef>
					<itemizedlist>
						<listitem> <para>posseses Copies</para> </listitem>
						<listitem> <para>belongs to Teams</para> </listitem>
					</itemizedlist>
				</glossdef>
			</glossentry>
			<glossentry xml:id="author">
				<glossterm>Author</glossterm>
				<glossdef>
					<itemizedlist>
						<listitem> <para>relation to Books</para> 
							<itemizedlist>
								<listitem> <para>single Book written by multiple Authors</para> </listitem>
								<listitem> <para>author to multiple Books</para> </listitem>
								<listitem> <para>how to ???</para> </listitem>
							</itemizedlist>
						</listitem>
					</itemizedlist>
				</glossdef>
			</glossentry>
			<glossentry xml:id="user">
				<glossterm>User</glossterm>
				<glossdef>
					<itemizedlist>
						<listitem> <para>person (like Author)</para> </listitem>
						<listitem> <para>Name</para> </listitem>
						<listitem> <para>Surname</para> </listitem>
						<listitem> <para>e-mail</para> </listitem>
						<listitem> <para>belongs to a Team but shouldn't know it</para> </listitem>
					</itemizedlist>
				</glossdef>
			</glossentry>
			<glossentry xml:id="borrower">
				<glossterm>Borrower</glossterm>
				<glossdef>
					<itemizedlist>
						<listitem> <para>posseses a Copy and offers it for Borrowing</para> </listitem>
						<listitem> <para>may be Lender simutaneously</para> </listitem>
						<listitem> <para>User (, Authorizer User)</para> </listitem>
						<listitem> <para>Java interface?</para> 
							<itemizedlist>
								<listitem> <para>User JSP tag for informations related to being in this Role</para> </listitem>
							</itemizedlist>
						</listitem>
						<listitem> <para>Security Role?</para> </listitem>
					</itemizedlist>
				</glossdef>
			</glossentry>
			<glossentry xml:id="lender">
				<glossterm>Lender</glossterm>
				<glossdef>
					<itemizedlist>
						<listitem> <para>Typically Team, sometimes User (Library for Copies of general and multi-topic Books)</para> </listitem> 
						<listitem> <para>Java interface or Security Role?</para> </listitem> 
					</itemizedlist>
				</glossdef>
			</glossentry>
			<glossentry xml:id="search">
				<glossterm>Search</glossterm>
				<glossdef>
					<itemizedlist>
						<listitem> <para>Books</para> 
							<itemizedlist>
								<listitem> <para>title</para> </listitem>
								<listitem> <para>author</para> </listitem>
								<listitem> <para>description</para> </listitem>
								<listitem> <para>edition date</para> </listitem>
								<listitem> <para>ISBN</para> 
									<itemizedlist>
										<listitem> <para> multiple formats</para> </listitem>
										<listitem> <para> multiple ISBNs (, 2 on Amazon)</para> </listitem>
									</itemizedlist>
								</listitem>
							</itemizedlist>
						</listitem>
						<listitem> <para>Users</para> 
							<itemizedlist>
								<listitem> <para>Name</para> </listitem>
								<listitem> <para>Surname</para> </listitem>
								<listitem> <para>Team</para> </listitem>
							</itemizedlist>
						</listitem>
					</itemizedlist>
				</glossdef>
			</glossentry>
		</glossary>
	</section>

	<section xml:id="steps"> <title>Steps</title>
		<procedure>
			<title>Plan of development of the application</title>
			<step><para>rewrite to text format</para>
				<substeps>
					<step><para>divide to separate documents</para></step>
					<step><para>allow adding pictures</para></step>
				</substeps> 
			</step>
			<step><para>navigation map?</para>
				<substeps>
					<step><para>would allow taking User's point of view</para></step>
				</substeps>
			</step>
			<step><para>diagrams of instances and classes</para></step>
			<step><para>diagrams of interactions during use-cases</para>
				<substeps>
					<step><para>between Domain and Infrastructure tiers</para></step>
					<step><para>between Web and Domain tiers</para></step>
				</substeps>
			</step>
			<step><para>mechanism for establishing possible User's operations availability during maintenance at the start of the application (with empty DB)</para></step>
			<step><para>distinguishing Query from Command</para></step>
			<step><para>distingsuishing Entities from Value Objects</para></step>
			<step><para>use-cases as tests</para>
				<substeps>
					<step><para>unit test of Domain, including Factories, Services and Repositories</para>
						<substeps>
							<step><para>from the point of view of User (/Web controller?)</para></step>
							<step><para>mock integration with Infrastructure layer</para></step>
							<step><para>Distill interface between web and domain</para>
								<substeps>
									<step><para>Java interface used in custom JSP tags?</para></step>
								</substeps>
							</step>
						</substeps>
					</step>
					<step><para>integration test with some in-memory DB?</para></step>
				</substeps>
			</step>
		</procedure>
	</section>

	<section xml:id="use-cases"> <title>Use-cases</title>
		<section xml:id='use-cases-list'><title>Preliminary list of use-cases</title>
			<orderedlist> 
				<listitem><para>Primary use-cases. Related to borrowing and returning of the books and of managing them. They make a library.</para>
					<orderedlist>
						<listitem>	
							<para>Books that belong to a library</para>
							<orderedlist>
								<listitem><para>Browsing books in library</para></listitem>
								<listitem><para>Borrowing books in library</para></listitem>
								<listitem><para>Returning a book from library</para></listitem>
								<listitem><para>Adding a book to a library</para></listitem>
								<listitem><para>Removing a book from a library</para></listitem>
							</orderedlist>
						</listitem>	
						<listitem><para>Books that belong to individual users</para>
							<orderedlist>
								<listitem><para>Browsing books in library</para></listitem>
								<listitem><para>Borrowing books in library</para></listitem>
								<listitem><para>Returning a book from library</para></listitem>
								<listitem><para>Adding a book to a library</para></listitem>
								<listitem><para>Removing a book from a library</para></listitem>
							</orderedlist>
							<para>Treat them like separate uses-cases or make them extend library book use-cases?</para>
							<para>Go for multiple libraries from the beginning or start with single? Kind of artificially prevents developing deep model of a book.</para>
							<para>Both borrowing and returning has to involve interactions by both parties so as to prevent frauds.</para>
						</listitem>	
						<listitem><para>Authorisation and authorisation. </para>
							<para>
								Neccessary for any restrictions involved in making borrowing and lending an honest transaction. 
								Users cannot possess possibility of a theft by claiming that the book was returned. 
								Users also cannot frame other users by claiming that they borrowed.
							</para>
							<orderedlist>
								<listitem><para>Domain of authentication system</para>
									<orderedlist>
										<listitem><para>Users</para></listitem>
										<listitem><para>Teams</para></listitem>
										<listitem><para>Roles</para></listitem>
									</orderedlist>
									<para>
										Model has to be plugable to make it possible use external authentication/authentication system. 
										It would be comfortable if it was also suitable for chosen technlogy, probably Spring Security (ACEGI).
									</para>
								</listitem>

							</orderedlist>
						</listitem>
					</orderedlist>
				</listitem>
				<listitem><para>Secondary use-cases.</para>
					<orderedlist>
						<listitem><para>Copy management</para></listitem>
						<listitem><para>Edition management</para></listitem>
						<listitem><para>History of borrowing</para>
							<orderedlist> 
								<listitem><para>History of a User</para></listitem>
								<listitem><para>History of a Copy (Edition?, Book?)</para></listitem>
							</orderedlist>
						</listitem>
						<listitem><para>Statistical information</para>
							<orderedlist> 
								<listitem><para>Most read Books</para></listitem>
								<listitem><para>Most borrowing Users</para></listitem>
							</orderedlist> 
						</listitem>
						<listitem><para>Recommending Books to buy</para></listitem>
						<listitem><para>Announcing bought Book</para>
							<orderedlist> 
								<listitem><para>Waitng list for a Book</para></listitem>
							</orderedlist> 
						</listitem>
						<listitem><para>Notifications for users</para>
							<orderedlist> 
								<listitem><para>Book on a waiting list is available</para></listitem>
								<listitem><para>Long time elapsed since a Book was borrowed</para></listitem>
								<listitem><para>New book is available</para></listitem>
								<listitem><para>New book is announced as bought</para></listitem>
							</orderedlist> 
						</listitem>
						<listitem><para>Amazon API integration. Book information, reviews.</para></listitem>
					</orderedlist>
				</listitem>
			</orderedlist>
		</section>

		<section xml:id='use-cases-themselves'><title>Use-cases themselves</title>
			<section xml:id='uc-browsing-books'><title>Browsing books</title>
				<variablelist>
					<varlistentry>
						<term>Primary actor</term>
						<listitem><para>any User</para></listitem>
					</varlistentry>
					<varlistentry>
						<term>Scope</term>
						<listitem>
							<para>
								<inlinemediaobject><imageobject><imagedata fileref="images/icons/system-black-box.png" /></imageobject></inlinemediaobject>
								system, black-box
							</para>
							<para>hides how Library owned and User-owned books differ</para>
							<para>hides Title vs Edition vs Copy distinctions</para>
						</listitem>
					</varlistentry>
					<varlistentry>
						<term>Level</term>
						<listitem>
							<para>
								<inlinemediaobject><imageobject><imagedata fileref="images/icons/user-goal.png" /></imageobject></inlinemediaobject>
								user-goal
							</para>
						</listitem>
					</varlistentry>
					<varlistentry>
						<term>Story</term>
						<listitem>
							<para>User can view all the books in the library together with information about their availability</para>
							<para>List is pageable with configurable page size</para>
							<para>? List is sortable by title, edition year, author?</para>
							<para>? List is filterable by title, edition year range, author, category?, tag?, description??</para>
						</listitem>
					</varlistentry>
				</variablelist>
			</section>

			<section xml:id='uc-borrowing-and-returning-copy'><title>Borrowing and Returning a Copy</title>
				<variablelist>
					<varlistentry>
						<term>Primary actor</term>
						<listitem><para>Authenticated User</para></listitem>
					</varlistentry>
					<varlistentry>
						<term>Scope</term>
						<listitem>
							<para> 
								<inlinemediaobject><imageobject><imagedata fileref="images/icons/organisation-white-box.png" /></imageobject></inlinemediaobject>
								organisation, white-box
							</para>
						</listitem>
					</varlistentry>
					<varlistentry>
						<term>Level</term>
						<listitem>
							<para>
								<inlinemediaobject><imageobject><imagedata fileref="images/icons/summary.png" /></imageobject></inlinemediaobject>
								summary
							</para>
						</listitem>
					</varlistentry>
					<varlistentry>
						<term>Stakeholders and Interests</term>
						<listitem>
							<para>Authenticated User (Borrower) and Lender</para>
							<para>Borrower has to have his Copy reserversion observed over other User that came for the same Copy without making reservation</para>
							<para>Borrower has to be protected against false claims that he physically got the book that he didn't</para>
							<para>Lender has to be protected against false claims that the book was physically returned when it didn't</para>
							<para>Individual Lender may refuse to borrow a Copy</para>
						</listitem>
					</varlistentry>
					<varlistentry>
						<term>Story</term>
						<listitem>
							<orderedlist>
								<listitem><para>Borrower reserves a Copy of an Edition</para></listitem>
								<listitem><para>Borrower physically obtains a Copy (outside of the system)</para></listitem>
								<listitem><para>Lender aknowledes that a Copy is borrowed to the User</para></listitem>
								<listitem><para>Borrower confirms that a Copy was borrowed by him</para></listitem>
								<listitem><para>Borrower reads the book (outside of the system)</para></listitem>
								<listitem><para>Borrower physically returns a Copy to the Lender</para></listitem>
								<listitem><para>Lender confirms that a Copy was returned</para></listitem>
							</orderedlist>
						</listitem>
					</varlistentry>
				</variablelist>
			</section>

			<section xml:id='uc-reserving-copy'><title>Reserving a Copy for Borrowing</title>
				<variablelist>
					<varlistentry>
						<term>Primary actor</term>
						<listitem><para>Authenticated User</para></listitem>
					</varlistentry>
					<varlistentry>
						<term>Scope</term>
						<listitem>
							<para>
								<inlinemediaobject><imageobject><imagedata fileref="images/icons/system-black-box.png" /></imageobject></inlinemediaobject>
								system, black-box
							</para>
						</listitem>
					</varlistentry>
					<varlistentry>
						<term>Level</term>
						<listitem>
							<para>
								<inlinemediaobject><imageobject><imagedata fileref="images/icons/user-goal.png" /></imageobject></inlinemediaobject>
								user-goal
							</para>
						</listitem>
					</varlistentry>
					<varlistentry>
						<term>Precondition</term>
						<listitem>
							<para>User is logged-in</para>
							<para>User is browsing Books</para>
							<para>a Copy of an Edition of a Title is available</para>
						</listitem>
					</varlistentry>
					<varlistentry>
						<term>Story</term>
						<listitem>
							<orderedlist>
								<listitem><para>User chooses to borrow particular Edition</para></listitem>
								<listitem><para>User is presented with detailed information about Edition and Title and the Owner of a Copy</para></listitem>
								<listitem><para>User confirms his decision</para></listitem>
								<listitem><para>System aknowledes decision</para>
									<orderedlist>
										<listitem><para>System makes a Copy of an Edition reserved for the User</para></listitem>
										<listitem><para>System provides information where the User may get a Copy</para></listitem>
										<listitem><para>System notifies Owner(s) of a Copy about reservation</para></listitem>
									</orderedlist>
								</listitem>
								<listitem><para>User goes to Owner's location to physically take a Copy (outside of the system)</para></listitem>
							</orderedlist>
						</listitem>
					</varlistentry>
				</variablelist>
			</section>
		</section>
	</section>

</article>
